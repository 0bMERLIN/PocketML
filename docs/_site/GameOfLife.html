<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li:not(:nth-child(6)) > a, .site-nav > ul.nav-list:first-child > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(6) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(6) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(6) > ul.nav-list { display: block; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Walkthrough: Coding Game of Life in PocketML | PocketML</title> <meta name="generator" content="Jekyll v3.10.0" /> <meta property="og:title" content="Walkthrough: Coding Game of Life in PocketML" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="A functional language to kill boredom." /> <meta property="og:description" content="A functional language to kill boredom." /> <link rel="canonical" href="http://localhost:4000/GameOfLife.html" /> <meta property="og:url" content="http://localhost:4000/GameOfLife.html" /> <meta property="og:site_name" content="PocketML" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Walkthrough: Coding Game of Life in PocketML" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"A functional language to kill boredom.","headline":"Walkthrough: Coding Game of Life in PocketML","url":"http://localhost:4000/GameOfLife.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> PocketML </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/Guide.html" class="nav-list-link">Language (& Installation) Guide</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Library Documentation category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/LibDocs.html" class="nav-list-link">Library Documentation</a><ul class="nav-list"><li class="nav-list-item"><a href="/LibDocs/calculus.html" class="nav-list-link">calculus</a></li><li class="nav-list-item"><a href="/LibDocs/dict.html" class="nav-list-link">dict</a></li><li class="nav-list-item"><a href="/LibDocs/either.html" class="nav-list-link">either</a></li><li class="nav-list-item"><a href="/LibDocs/graphing.html" class="nav-list-link">graphing</a></li><li class="nav-list-item"><a href="/LibDocs/image.html" class="nav-list-link">image</a></li><li class="nav-list-item"><a href="/LibDocs/input.html" class="nav-list-link">input</a></li><li class="nav-list-item"><a href="/LibDocs/list.html" class="nav-list-link">list</a></li><li class="nav-list-item"><a href="/LibDocs/math.html" class="nav-list-link">math</a></li><li class="nav-list-item"><a href="/LibDocs/maybe.html" class="nav-list-link">maybe</a></li><li class="nav-list-item"><a href="/LibDocs/numpy.html" class="nav-list-link">numpy</a></li><li class="nav-list-item"><a href="/LibDocs/parsing.html" class="nav-list-link">parsing</a></li><li class="nav-list-item"><a href="/LibDocs/shaders.html" class="nav-list-link">shaders</a></li><li class="nav-list-item"><a href="/LibDocs/sound.html" class="nav-list-link">sound</a></li><li class="nav-list-item"><a href="/LibDocs/std.html" class="nav-list-link">std</a></li><li class="nav-list-item"><a href="/LibDocs/string.html" class="nav-list-link">string</a></li><li class="nav-list-item"><a href="/LibDocs/tea.html" class="nav-list-link">tea</a></li><li class="nav-list-item"><a href="/LibDocs/ugraph.html" class="nav-list-link">ugraph</a></li><li class="nav-list-item"><a href="/LibDocs/util.html" class="nav-list-link">util</a></li></ul></li><li class="nav-list-item"><a href="/Hacking.html" class="nav-list-link">Hacking & Python Interop</a></li><li class="nav-list-item"><a href="/BlogModules.html" class="nav-list-link">Blog: Module functors in PocketML</a></li><li class="nav-list-item"><a href="/Features.html" class="nav-list-link">Features &amp; The type system</a></li><li class="nav-list-item"><a href="/GameOfLife.html" class="nav-list-link">Walkthrough: Coding Game of Life in PocketML</a></li><li class="nav-list-item"><a href="/CalcGUI.html" class="nav-list-link">Walkthrough: Coding a GUI calculator in PocketML</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search PocketML" aria-label="Search PocketML" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main-content-wrap"> <div id="main-content" class="main-content"> <main> <h2 id="walkthrough-coding-game-of-life-in-pocketml"> <a href="#walkthrough-coding-game-of-life-in-pocketml" class="anchor-heading" aria-labelledby="walkthrough-coding-game-of-life-in-pocketml"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Walkthrough: Coding Game of Life in PocketML </h2> <h4 id="11-conways-game-of-life"> <a href="#11-conways-game-of-life" class="anchor-heading" aria-labelledby="11-conways-game-of-life"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1.1 Conways Game of Life </h4> <p>I think most people in this space are familiar with Game of Life, but heres a quick overview:</p> <p>Conways Game of Life is a grid based simulation of cells. They can die, live or come to life. The rules are very simple but give rise to emergent organic-looking behaviour. Game of Life is actually Turing complete.</p> <p><img src="https://upload.wikimedia.org/wikipedia/commons/e/e5/Gospers_glider_gun.gif" /></p> <p>The rules are as follows:</p> <ul> <li>A cells stays alive and/or gets born when it has three alive neighbours</li> <li>A cell dies when it has more or less than 3 neighbours.</li> </ul> <h4 id="12-setup-in-pocketml"> <a href="#12-setup-in-pocketml" class="anchor-heading" aria-labelledby="12-setup-in-pocketml"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1.2 Setup in PocketML </h4> <p>First we’ll need some libraries:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">lib.std</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">lib.image</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">lib.math</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">lib.tea</span><span class="p">;</span>
</code></pre></div></div> <p>We will represent the playing grid as a small image. Let’s start with a 60x60 grid. We can create an image by calling the <code class="language-plaintext highlighter-rouge">image</code> function with a vector that denotes the size (<code class="language-plaintext highlighter-rouge">@(width, height)</code>):</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>let w = 60;
let i = image @(w,w);
</code></pre></div></div> <blockquote> <p>Note: I left out the types. PocketML can infer them. If you were to click on the typing-button in the editor with the cursor on our image <code class="language-plaintext highlighter-rouge">i</code>, you would get <code class="language-plaintext highlighter-rouge">i : Img</code>.</p> </blockquote> <h4 id="13-checking-neighbouring-cells"> <a href="#13-checking-neighbouring-cells" class="anchor-heading" aria-labelledby="13-checking-neighbouring-cells"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1.3 Checking neighbouring cells </h4> <p>To determine if a cell should live or die, we need to know the number of living neighbours. To access the neighbours we will use offsets from the position of the cell we want to check:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">let</span> <span class="n">offsets</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">@</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="o">@</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="o">@</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
    <span class="o">@</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="o">@</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="c1"># The middle row has only two cells, because
</span>    <span class="c1"># we do not want to count the cell itself.
</span>    <span class="o">@</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="o">@</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="o">@</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="p">];</span>
</code></pre></div></div> <p>To get all the neighbouring pixels/cells we will map over the offsets:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">map</span> <span class="p">(</span>\<span class="n">offset</span> <span class="o">-&gt;</span>
    <span class="n">let</span> <span class="n">p</span> <span class="o">=</span> <span class="n">imgGet</span> <span class="n">buf</span> <span class="p">(</span><span class="n">v</span> <span class="o">+</span> <span class="n">offset</span><span class="p">);</span> <span class="c1"># v + o is vector addition!
</span>    <span class="c1"># Out of bounds access to an image returns the empty vector.
</span>    <span class="k">if</span> <span class="n">vecLen</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">0</span> <span class="n">then</span> <span class="mi">0</span> <span class="k">else</span>
    <span class="n">vecAt</span> <span class="mi">0</span> <span class="n">p</span><span class="p">)</span>
<span class="n">offsets</span>
</code></pre></div></div> <p>Now we can filter them to only get the live cells and then count them using <code class="language-plaintext highlighter-rouge">len</code>. Let’s also wrap the entire thing in a function:</p> <div class="language-sml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">let</span> <span class="n">nAlive</span> <span class="n">buf</span> <span class="n">v</span> <span class="p">=</span>
	<span class="kr">let</span> <span class="n">offsets</span> <span class="p">=</span> <span class="p">[</span>
		<span class="n">@</span><span class="p">(</span><span class="n">-</span><span class="mi">1</span><span class="p">,</span><span class="n">-</span><span class="mi">1</span><span class="p">),</span><span class="n">@</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">-</span><span class="mi">1</span><span class="p">),</span><span class="n">@</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">-</span><span class="mi">1</span><span class="p">),</span>
		<span class="n">@</span><span class="p">(</span><span class="n">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">@</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
		<span class="n">@</span><span class="p">(</span><span class="n">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">@</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">@</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
	<span class="p">];</span>
	
	<span class="n">len</span> <span class="p">(</span><span class="n">filter</span> <span class="p">(</span><span class="n">\x</span> <span class="p">-&gt;</span> <span class="n">x</span> <span class="n">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">$</span>
		<span class="n">map</span> <span class="p">(</span><span class="n">\o</span> <span class="p">-&gt;</span>
			<span class="kr">let</span> <span class="n">p</span> <span class="p">=</span> <span class="n">imgGet</span> <span class="n">buf</span> <span class="p">(</span><span class="n">v+o</span><span class="p">);</span>
			<span class="kr">if</span> <span class="n">vecLen</span> <span class="n">p</span> <span class="n">==</span> <span class="mi">0</span> <span class="kr">then</span> <span class="mi">0</span> <span class="kr">else</span>
			<span class="n">vecAt</span> <span class="mi">0</span> <span class="n">p</span><span class="p">)</span>
		<span class="n">offsets</span><span class="p">);</span>
</code></pre></div></div> <h4 id="14-updating-the-cells"> <a href="#14-updating-the-cells" class="anchor-heading" aria-labelledby="14-updating-the-cells"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1.4 Updating the cells </h4> <p>We can write the rules from above as a function:</p> <div class="language-sml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">let</span> <span class="n">determineAlive</span> <span class="p">:</span> <span class="n">Bool</span> <span class="p">-&gt;</span> <span class="n">Number</span> <span class="p">-&gt;</span> <span class="n">Bool</span><span class="p">;</span>
<span class="kr">let</span> <span class="n">determineAlive</span> <span class="n">c</span> <span class="n">n</span> <span class="p">=</span>
	<span class="kr">if</span> <span class="n">c</span> <span class="kr">then</span> <span class="n">not</span> <span class="p">(</span><span class="n">n</span> <span class="n">&lt;</span> <span class="mi">2</span> <span class="n">||</span> <span class="n">n</span> <span class="n">&gt;</span> <span class="mi">3</span><span class="p">)</span>
	<span class="kr">else</span> <span class="p">(</span><span class="n">n</span> <span class="n">==</span> <span class="mi">3</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div></div> <p>Now we can copy our image to a buffer for fast read access and map over every pixel using <code class="language-plaintext highlighter-rouge">imgMap</code> from lib.image. We’ll color live pixels white and dead ones black.</p> <blockquote> <p>Note: This mutates our image, which is a sin in functional languages, but we’ll go with it to increase performance</p> </blockquote> <div class="language-sml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">let</span> <span class="n">tick</span> <span class="n">img</span> <span class="p">=</span>
	<span class="kr">let</span> <span class="n">buf</span> <span class="p">=</span> <span class="n">imgBuf</span> <span class="n">img</span><span class="p">;</span>
	<span class="n">imgMap</span> <span class="n">img</span> <span class="p">(</span><span class="n">\x</span> <span class="n">y</span> <span class="n">cell</span> <span class="p">-&gt;</span>
		<span class="kr">let</span> <span class="n">n</span> <span class="p">=</span> <span class="n">nAlive</span> <span class="n">buf</span> <span class="n">@</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">);</span>
		<span class="kr">let</span> <span class="n">c</span> <span class="p">=</span> <span class="n">vecAt</span> <span class="mi">0</span> <span class="n">cell</span> <span class="n">&gt;</span> <span class="mi">0</span><span class="p">;</span>
			<span class="kr">if</span> <span class="n">determineAlive</span> <span class="n">c</span> <span class="n">n</span>
			<span class="kr">then</span> <span class="n">@</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">)</span>
			<span class="kr">else</span> <span class="n">@</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">)</span>
    <span class="p">);</span>
</code></pre></div></div> <h4 id="15-populating-our-playing-grid"> <a href="#15-populating-our-playing-grid" class="anchor-heading" aria-labelledby="15-populating-our-playing-grid"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1.5 Populating our playing grid </h4> <p>We could have loaded our image from a file using <code class="language-plaintext highlighter-rouge">imgLoad</code>. Alternatively we can make a function to add cell patterns from a 2D list:</p> <blockquote> <p>Note: imap &lt;=&gt; “map with index”. This is similar to/inspired by a for loop with enumerate in python. The builtin <code class="language-plaintext highlighter-rouge">map</code> functions are also fast because they use python for loops internally.</p> </blockquote> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">let</span> <span class="n">addPattern</span> <span class="n">img</span> <span class="n">v</span> <span class="n">p</span><span class="o">=</span><span class="n">imap</span> <span class="p">(</span>\<span class="n">y</span> <span class="n">l</span><span class="o">-&gt;</span> <span class="n">imap</span> <span class="c1"># rows
</span>	<span class="p">(</span>\<span class="n">x</span> <span class="n">c</span><span class="o">-&gt;</span> <span class="n">setpixel</span> <span class="n">img</span> <span class="p">(</span><span class="n">v</span><span class="o">+@</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span> <span class="c1"># columns
</span>		<span class="p">(</span><span class="o">@</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="mi">255</span><span class="p">)</span> <span class="err">°</span> <span class="mi">255</span><span class="p">)</span>
	<span class="p">)</span> <span class="n">l</span><span class="p">)</span> <span class="n">p</span><span class="p">;</span>
</code></pre></div></div> <h4 id="16-running-the-app--event-loop"> <a href="#16-running-the-app--event-loop" class="anchor-heading" aria-labelledby="16-running-the-app--event-loop"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1.6 Running the app / Event loop </h4> <p>Because we want to actually see the game, we need to build a GUI. We need <code class="language-plaintext highlighter-rouge">update</code>, the initial state and <code class="language-plaintext highlighter-rouge">view</code> like in ELM. Let’s count the ticks since the app started to slow down the games tick/update rate a little:</p> <blockquote> <p>Note: Our state is <code class="language-plaintext highlighter-rouge">Number</code> in this case (the number of ticks)! We’ll increase (<code class="language-plaintext highlighter-rouge">inc</code>) it every frame.</p> </blockquote> <div class="language-sml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">let</span> <span class="n">update</span> <span class="p">:</span> <span class="n">Event</span> <span class="p">-&gt;</span> <span class="n">Number</span> <span class="p">-&gt;</span> <span class="n">Number</span><span class="p">;</span>
<span class="kr">let</span> <span class="n">update</span> <span class="n">e</span> <span class="n">t</span> <span class="p">=</span> <span class="kr">case</span> <span class="n">e</span>
    <span class="p">|</span> <span class="n">Tick</span> <span class="p">-&gt;</span> <span class="kr">do</span>
        <span class="n">when</span> <span class="p">(</span><span class="n">divisible</span> <span class="n">t</span> <span class="mi">5</span><span class="p">)</span> <span class="p">(</span><span class="n">\</span><span class="p">_</span> <span class="p">-&gt;</span> <span class="n">tick</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">inc</span> <span class="n">t</span>
<span class="p">;</span>
</code></pre></div></div> <p>The playing field will be displayed using a textured rectangle (<code class="language-plaintext highlighter-rouge">TRect</code>).</p> <div class="language-sml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">let</span> <span class="n">view</span> <span class="p">_</span> <span class="p">=</span> <span class="n">TRect</span> <span class="n">@</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="n">@</span><span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="n">width</span><span class="p">)</span> <span class="n">i</span><span class="p">;</span>
</code></pre></div></div> <p>Now we can start the app using <code class="language-plaintext highlighter-rouge">setTick</code>:</p> <div class="language-sml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">setTick</span> <span class="mi">0</span> <span class="n">update</span> <span class="n">view</span>
</code></pre></div></div> <h4 id="17-add-patterns"> <a href="#17-add-patterns" class="anchor-heading" aria-labelledby="17-add-patterns"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1.7 Add patterns </h4> <p>I have added a gosper glider gun:</p> <div class="language-sml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">let</span> <span class="p">_</span> <span class="p">=</span> <span class="kr">do</span>
	<span class="n">addPattern</span> <span class="n">i</span> <span class="n">@</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span> <span class="n">gosper</span>
<span class="p">;</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">gosper</code> is a really big list, so you’ll have to see the source code (gol.ml) for the details :).</p> <h4 id="18-end-result--gallery"> <a href="#18-end-result--gallery" class="anchor-heading" aria-labelledby="18-end-result--gallery"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1.8 End result / Gallery </h4> <p><img src="/gameoflife.png" alt="An image of the end result (Glider gun)" /></p> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
