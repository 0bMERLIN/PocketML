<html>
  <head>
    
    
    
    <link rel="stylesheet" href="/assets/main.css">
    <style>
        body {
            padding: 20px;
        }

        #navbar {
            display: flex;
            background-color: #f8f9fa;
            padding: 10px;
            border-bottom: 1px solid #dee2e6;
        }
    </style>
  </head>
  <body>
    <div id="navbar">
    <img src="../assets/logo.jpeg" alt="PocketML Logo" style="width: 100px; height: auto;">
    </div>
    <h2 id="hacking--extending">Hacking / Extending</h2>

<h4 id="11-writing-your-own-libraries">1.1 Writing your own libraries</h4>
<p>PocketML is not opinionated when it comes to project structure. All default libraries are in <code class="language-plaintext highlighter-rouge">lib/</code>.</p>

<p>You can also write bigger chunks of code on your pc for testing and then transfer them. Connect your phone via USB and open the folder <code class="language-plaintext highlighter-rouge">Internal Storage/Android/data/org.test.myapp/files/</code>.</p>

<h4 id="12-python-interop">1.2 Python interop</h4>
<p>PocketML is compiled to python. It
has access to all features of python and the
libraries <code class="language-plaintext highlighter-rouge">numpy</code>, <code class="language-plaintext highlighter-rouge">pygments</code>, <code class="language-plaintext highlighter-rouge">lark</code>, and <code class="language-plaintext highlighter-rouge">kivy</code>.
Python code can be included in PocketML code using
<code class="language-plaintext highlighter-rouge">%%% ... %%%</code>. PocketML uses the <code class="language-plaintext highlighter-rouge">PML_[varname]</code> naming scheme internally. Python functions exported to PocketML should be named accordingly.</p>

<div class="language-sml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">%%%</span>
<span class="n">def</span> <span class="n">half</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">return</span> <span class="n">x</span> <span class="n">/</span> <span class="mi">2</span>

<span class="n">PML_half</span> <span class="p">=</span> <span class="n">half</span>
<span class="n">%%%</span><span class="p">;</span>

<span class="kr">let</span> <span class="n">half</span> <span class="p">:</span> <span class="n">Number</span> <span class="p">-&gt;</span> <span class="n">Number</span><span class="p">;</span>

<span class="n">print</span> <span class="p">(</span><span class="n">half</span> <span class="mi">2</span><span class="p">)</span>
</code></pre></div></div>

<p>Python code can also be used to compute values
in PocketML code using the inline <code class="language-plaintext highlighter-rouge">%% ... %%</code> syntax.
Python types are largely compatible with PocketML types.</p>
<div class="language-sml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">print</span> <span class="n">%%f</span><span class="s2">"PocketML does not have f-strings but python does {'!'*10}"</span><span class="n">%%</span>
</code></pre></div></div>
<p>Another example:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">lib.std</span><span class="p">;</span>

<span class="c1"># get name and greet!
</span><span class="nb">input</span> <span class="s">"Name:"</span> <span class="p">(</span>\<span class="n">nm</span> <span class="o">-&gt;</span> <span class="k">print</span> <span class="o">%%</span><span class="sa">f</span><span class="s">"Hi, </span><span class="si">{</span><span class="n">PML_nm</span><span class="si">}</span><span class="s">!"</span><span class="o">%%</span><span class="p">)</span>
</code></pre></div></div>

<p>As discussed in the <a href="/Guide.html">Language Guide</a> on <em>records</em>, one can also build a function with default arguments using python interop:</p>

<div class="language-sml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">let</span> <span class="n">mkVec</span> <span class="p">:</span> <span class="p">{</span> <span class="n">x</span> <span class="p">:</span> <span class="n">Number</span><span class="p">,</span> <span class="n">y</span> <span class="p">:</span> <span class="n">Number</span><span class="p">,</span> <span class="n">z</span> <span class="p">:</span> <span class="n">Number</span> <span class="p">}</span> <span class="p">-&gt;</span> <span class="n">Vec</span><span class="p">;</span>

<span class="n">%%%</span>
<span class="n">def</span> <span class="n">PML_mkVec</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
    <span class="n">defaults</span> <span class="p">=</span> <span class="p">{</span><span class="s2">"x"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s2">"y"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s2">"z"</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
    <span class="nn">defaults</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">return</span> <span class="nn">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">list</span><span class="p">(</span><span class="nn">defaults</span><span class="p">.</span><span class="n">values</span><span class="p">()))</span>
<span class="n">%%%</span><span class="p">;</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span> <span class="err">$</span> <span class="n">mkVec</span> <span class="p">{</span><span class="n">y</span><span class="o">=</span><span class="mi">20</span><span class="p">}</span> <span class="c1"># =&gt; [ 0 20  0]
</span></code></pre></div></div>

<h4 id="13-the-editor">1.3 The editor</h4>

<h5 id="extending-and-hacking">Extending and hacking!</h5>
<p>The PocketML editor is accessible to the language by using python interop.
The editor object can be accessed directly by the name <code class="language-plaintext highlighter-rouge">editor</code>. It contains the “terminalout”
and “graphicalout” objects.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%%%</span>
<span class="k">def</span> <span class="nf">cls</span><span class="p">(</span><span class="n">_</span><span class="p">):</span>
    <span class="c1"># example usage:
</span>    <span class="c1"># clear the terminal
</span>    <span class="n">editor</span><span class="p">.</span><span class="n">terminalout</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">""</span>
<span class="o">%%%</span><span class="p">;</span>
<span class="p">()</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">editor.graphicalout</code> is the kivy object for the “Graphics” tab in the editor and can be added to / manipulated like any other kivy object.</p>

<p>For a better insight into accessing the graphicalout object from code,
refer to the <code class="language-plaintext highlighter-rouge">tea.ml</code> library.</p>


  </body>
</html>